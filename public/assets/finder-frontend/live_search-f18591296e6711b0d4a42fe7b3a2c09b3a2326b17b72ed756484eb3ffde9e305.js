!function(){"use strict";function s(t){if(this.state=!1,this.previousState=!1,this.resultCache={},this.$form=t.$form,this.$searchSubmitButton=this.$form.querySelector(".gem-c-search__submit"),this.$resultsWrapper=this.$form.querySelector(".js-live-search-results-block"),this.$suggestionsBlock=this.$form.querySelector("#js-spelling-suggestions"),this.$resultsBlock=t.$results.querySelector("#js-results"),this.$countBlock=t.$results.querySelector("#js-result-count"),this.$mobileResultsCount=this.$form.querySelector(".js-result-count"),this.$selectedFilterCount=this.$form.querySelector(".js-selected-filter-count"),this.$facetTagBlock=t.$results.querySelector("#js-facet-tag-wrapper"),this.$mobileFacetTagBlock=this.$form.querySelector(".js-mobile-facet-tag-block"),this.$loadingBlock=t.$results.querySelector("#js-loading-message"),this.$sortBlock=t.$results.querySelector("#js-sort-options"),this.$paginationBlock=t.$results.querySelector("#js-pagination"),this.action=this.$form.getAttribute("action")+".json",this.$atomAutodiscoveryLink=t.$atomAutodiscoveryLink,this.baseTitle=document.querySelector("meta[name='govuk:base_title']"),this.baseTitle?this.baseTitle=this.baseTitle.getAttribute("content"):this.baseTitle=document.title,this.$resultsCountMetaTag=document.querySelector("meta[name='govuk:search-result-count']"),this.$emailLinks=document.querySelectorAll('[href*="email-signup"]'),this.previousSearchTerm="",this.$emailLinks[0]&&(this.emailSignupHref=this.$emailLinks[0].getAttribute("href")),this.$atomLinks=document.querySelectorAll('[href*=".atom"]'),this.$atomLinks[0]&&(this.atomHref=this.$atomLinks[0].getAttribute("href")),this.bindSortElements(),this.getAndUpdateTaxonomyFacet(),window.ga&&window.ga("set","transport","beacon"),this.Ga4EcommerceTracking(),this.focusErrorMessagesOnLoad(this.$form),this.$searchSubmitButton&&this.$searchSubmitButton.addEventListener("click",function(t){t.preventDefault(),this.formChange()}.bind(this)),i.support.history()){this.saveState(),this.$form.addEventListener("change",this.formChange.bind(this)),this.$form.addEventListener("customFormChange",this.formChange.bind(this)),this.handleKeyPress=function(t){var e=13;if(t.keyCode===e||"change"===t.type){var r=t.suppressAnalytics||t.detail&&t.detail.suppressAnalytics;t.currentTarget.value===this.previousSearchTerm||r||s.prototype.fireTextAnalyticsEvent(t),this.formChange(),this.previousSearchTerm=t.currentTarget.value,t.preventDefault()}};for(var e=this.$form.querySelectorAll("input[type=text],input[type=search]"),r=0;r<e.length;r++)e[r].addEventListener("change",this.handleKeyPress.bind(this)),e[r].addEventListener("keypress",this.handleKeyPress.bind(this));this.indexTrackingData(),document.addEventListener("popstate",this.popState.bind(this))}else{this.$form.querySelector(".js-live-search-fallback").style.display="block"}}window.GOVUK=window.GOVUK||{};var i=window.GOVUK;s.prototype.startEnhancedEcommerceTracking=function e(){if(this.$resultsWrapper){this.$resultsWrapper.setAttribute("data-search-query",this.currentKeywords());var t=this.$resultsWrapper.querySelector(".js-order-results");t&&this.$resultsWrapper.setAttribute("data-ecommerce-variant",t.options[t.selectedIndex].text)}this.$suggestionsBlock&&this.$suggestionsBlock.setAttribute("data-search-query",this.currentKeywords()),i.Ecommerce&&i.Ecommerce.start(),this.Ga4EcommerceTracking(this.previousSearchUrl)},s.prototype.Ga4EcommerceTracking=function(t){if(i.analyticsGa4&&i.analyticsGa4.Ga4EcommerceTracker){var e=i.getConsentCookie();e&&e.settings?i.analyticsGa4.Ga4EcommerceTracker.init(t):window.addEventListener("cookie-consent",function(){i.analyticsGa4.Ga4EcommerceTracker.init(t)})}},s.prototype.getAndUpdateTaxonomyFacet=function r(){var t=document.querySelector(".js-taxonomy-select");t&&(this.taxonomy=this.taxonomy||new i.TaxonomySelect({$el:t}),this.taxonomy.update())},s.prototype.getSerializeForm=function a(){for(var t=this.$form.elements,e=[],r=0;r<t.length;r++){var s=t[r];if(s.type&&"checkbox"!==s.type&&"radio"!==s.type||s.checked){var i=s.getAttribute("name"),o=s.value;i&&o&&"option-select-filter"!==i&&e.push({name:i,value:o})}}return e},s.prototype.saveState=function o(t){void 0===t&&(t=this.getSerializeForm()),this.previousState=this.state,this.state=t},s.prototype.popState=function n(t){t.originalEvent.state&&(this.saveState(t.originalEvent.state),this.updateOrder(),this.updateResults(),this.restoreBooleans(),this.restoreTextInputs())},s.prototype.formChange=function t(){this.isNewState()&&(this.getAndUpdateTaxonomyFacet(),this.saveState(),this.updateOrder(),this.updateLinks(),this.updateTitle(),this.updateResults())},s.prototype.serializeState=function(t){var e=[];if(Array.isArray(t))for(var r=0;r<t.length;r++)e.push(t[r].name+"="+t[r].value);else for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e.join("&")},s.prototype.setRelevantResultCustomDimension=function l(){var t=this.$form.querySelector(".gem-c-document-list__item--highlight")?"yes":"no";i.SearchAnalytics.setDimension(83,t)},s.prototype.trackingInit=function c(){i.modules.start(this.$resultsWrapper),this.indexTrackingData(),this.startEnhancedEcommerceTracking()},s.prototype.trackPageView=function u(){var t=window.location.pathname+"?"+this.serializeState(this.state);i.SearchAnalytics.trackPageview(t),i.SearchAnalytics.trackPageview(t,document.title,{trackerName:"govuk"})},s.prototype.trackSpellingSuggestionsImpressions=function h(){var t=document.querySelector("meta[name='govuk:spelling-suggestion']");if(this.$suggestionsBlock&&t){var e=this.$suggestionsBlock.querySelector("a"),r="";e&&(r=(e=JSON.parse(e.getAttribute("data-track-options"))).dimension81),t.setAttribute("content",r)}},s.prototype.indexTrackingData=function p(){for(var t=document.querySelectorAll(".filtered-results__group"),e=0;e<t.length;e++)for(var r=t[e].querySelectorAll(".gem-c-document-list__item"),s=0;s<r.length;s++){var i=r[s].querySelector(".gem-c-document-list__item-title"),o=i.getAttribute("data-track-action");o=[o=o.replace(/\.\d+$/,""),e+1,s+1].join("."),i.setAttribute("data-track-action",o)}var a=document.querySelector(".js-finder-results");if(a){var n=a.querySelector(".gem-c-document-list__item--highlight");n&&(o=n.getAttribute("data-track-action"),o+="r",n.setAttribute("data-track-action",o))}},s.prototype.fireTextAnalyticsEvent=function d(t){var e={transport:"beacon",label:t.target.value},r="filterClicked",s=document.querySelector('label[for="'+t.target.id+'"]').textContent;i.SearchAnalytics.trackEvent(r,s,e)},s.prototype.cache=function m(t,e){if(void 0===e)return this.resultCache[t];this.resultCache[t]=e},s.prototype.isNewState=function g(){return this.serializeState(this.state)!==this.serializeState(this.getSerializeForm())},s.prototype.updateTitle=function f(){var t=this.currentKeywords(),e=""!==t;document.title=e?t+" - "+this.baseTitle:this.baseTitle},s.prototype.updateResultsCountMeta=function y(t){this.$resultsCountMetaTag&&this.$resultsCountMetaTag.setAttribute("content",t)},s.prototype.updateSortOptions=function v(t,e){e===this.serializeState(this.state)&&(this.updateElement(this.$sortBlock,t.sort_options_markup),this.bindSortElements())},s.prototype.bindSortElements=function S(){this.$orderSelect=this.$form.querySelector(".js-order-results"),this.$orderSelect&&(this.$relevanceOrderOption=this.$orderSelect.querySelector("option[value="+this.$orderSelect.getAttribute("data-relevance-sort-option")+"]"))},s.prototype.currentKeywords=function k(){return this.getTextInputValue("keywords",this.state)},s.prototype.updateOrder=function $(){if(this.$orderSelect){var t=""!==this.currentKeywords(),e=""!==this.getTextInputValue("keywords",this.previousState),r=!t&&e;t&&!e&&this.selectRelevanceSortOption(),r&&this.selectDefaultSortOption()}},s.prototype.selectDefaultSortOption=function b(){var t=this.$orderSelect.getAttribute("data-default-sort-option");this.$orderSelect.value=t,this.state=this.getSerializeForm()},s.prototype.selectRelevanceSortOption=function A(){var t=this.$orderSelect.getAttribute("data-relevance-sort-option");t&&(this.$relevanceOrderOption.removeAttribute("disabled"),this.$orderSelect.value=t,this.state=this.getSerializeForm())},s.prototype.updateResults=function E(){var r=this.serializeState(this.state),t=this.cache(r),s=this;if(this.previousSearchUrl=window.location.href,void 0===t){this.showLoadingIndicator();var i=new XMLHttpRequest,e=this.action+"?"+encodeURI(r),o=function(t){if(4===i.readyState&&200===i.status){var e=JSON.parse(t.target.response);s.updateUrl(),s.cache(s.serializeState(s.state),e),s.displayResults(e,r),s.trackSearch()}else s.showErrorIndicator()};i.open("GET",e,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.addEventListener("load",o),i.send()}else this.updateUrl(),this.displayResults(t,r),this.trackSearch()},s.prototype.updateUrl=function(){var t=encodeURI(window.location.pathname+"?"+this.serializeState(this.state));window.history.pushState(this.state,"",t)},s.prototype.trackSearch=function(){this.trackingInit(),this.setRelevantResultCustomDimension(),this.trackPageView()},s.prototype.updateLinks=function T(){var t="?"+this.serializeState(this.state);if("undefined"!=typeof this.emailSignupHref&&null!=this.emailSignupHref)for(var e=0;e<this.$emailLinks.length;e++)this.$emailLinks[e].setAttribute("href",encodeURI(this.emailSignupHref.split("?")[0]+t));if("undefined"!=typeof this.atomHref&&null!=this.atomHref){for(var r=0;r<this.$atomLinks.length;r++)this.$atomLinks[r].setAttribute("href",encodeURI(this.atomHref.split("?")[0]+t));this.$atomAutodiscoveryLink.setAttribute("href",encodeURI(this.atomHref.split("?")[0]+t))}},s.prototype.showLoadingIndicator=function w(){this.$loadingBlock.textContent="Loading...",this.$loadingBlock.style.display="block"},s.prototype.showErrorIndicator=function q(){this.$loadingBlock.textContent="Error. Please try modifying your search and trying again."},s.prototype.updateElement=function L(t,e){t&&(t.innerHTML=e)},s.prototype.displayResults=function C(t,e){e===this.serializeState(this.state)&&(this.updateElement(this.$resultsBlock,t.search_results),this.updateElement(this.$facetTagBlock,t.facet_tags),this.updateElement(this.$countBlock,t.display_total),this.updateElement(this.$mobileResultsCount,t.display_total),this.updateElement(this.$mobileFacetTagBlock,t.facet_tags),this.updateElement(this.$selectedFilterCount,t.display_selected_facets_count),this.updateElement(this.$paginationBlock,t.next_and_prev_links),this.updateElement(this.$suggestionsBlock,t.suggestions),this.trackSpellingSuggestionsImpressions(t.suggestions),this.updateSortOptions(t,e),this.updateResultsCountMeta(t.total),this.manipulateErrorMessages(t.errors),this.$atomAutodiscoveryLink.setAttribute("href",t.atom_url),this.$loadingBlock.textContent="",this.$loadingBlock.style.display="none")},s.prototype.restoreBooleans=function x(){for(var t=this.$form.querySelectorAll("input[type=checkbox], input[type=radio]"),e=0;e<t.length;e++){var r=t[e];r.setAttribute("checked",this.isBooleanSelected(r.getAttribute("name"),r.value))}},s.prototype.isBooleanSelected=function B(t,e){var r,s;for(r=0,s=this.state.length;r<s;r++)if(this.state[r].name===t&&this.state[r].value===e)return!0;return!1},s.prototype.restoreTextInputs=function _(){for(var t=this.$form.querySelectorAll("input[type=text], input[type=search], select"),e=0;e<t.length;e++){var r=t[e];r.value=this.getTextInputValue(r.getAttribute("name"),this.state)}},s.prototype.getTextInputValue=function R(t,e){var r,s;for(r=0,s=e.length;r<s;r++)if(e[r].name===t)return e[r].value;return""},s.prototype.focusErrorMessagesOnLoad=function(t){var e=t.querySelector(".govuk-input--error");e&&e.focus()},s.prototype.manipulateErrorMessages=function(t){if(t)for(var e in t){var r=e;for(var s in t[e]){t[e][s]?this.renderErrorMessage(r,s):this.removeErrorMessage(r,s)}}},s.prototype.renderErrorMessage=function(t,e){var r=this.$form.querySelector('input[name*="'+t+"["+e+']"]'),s=document.createElement("span");if(s.setAttribute("id","error-"+t),s.setAttribute("class","gem-c-error-message govuk-error-message"),s.innerHTML='<span class="govuk-visually-hidden">Error:</span> Enter a real date',0===r.parentNode.querySelectorAll(".gem-c-error-message").length){r.classList.add("govuk-input--error"),r.insertAdjacentElement("beforebegin",s);var i=r.parentNode;i.classList.contains("govuk-form-group")&&i.classList.add("govuk-form-group--error"),r.setAttribute("aria-describedby",r.getAttribute("aria-describedby")+" "+s.getAttribute("id"))}r.focus()},s.prototype.removeErrorMessage=function(t,e){var r=this.$form.querySelector('input[name*="'+t+"["+e+']"]');if(r){var s=r.parentNode.querySelectorAll(".gem-c-error-message");if(0<s.length){r.classList.remove("govuk-input--error");for(var i=s.length-1;0<=i;i--)s[i].parentNode.removeChild(s[i]);var o=r.parentNode;o.classList.contains("govuk-form-group")&&o.classList.remove("govuk-form-group--error"),r.setAttribute("aria-describedby","")}}},i.LiveSearch=s}();